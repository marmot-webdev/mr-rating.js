/**!
 * mr-rating.js
 * @version: 1.0.0
 * @author: Serhii Babakov <marmot.webdev@gmail.com>
 * @url: https://github.com/marmot-webdev/mr-rating.js
 * @license: MIT
 */
var Rating=function(){"use strict";const t={classList:{containerClass:"mr-rating",itemClass:"",activeClass:"active",selectedClass:"selected"},icon:"",items:null,label:"Rating",orientation:"horizontal",tooltip:!1,onInit:null,onDestroy:null,onReset:null,onSelect:null},e=t=>Object.prototype.toString.call(t).slice(8,-1),s=t=>"Object"===e(t),i=t=>Object.entries(t.dataset).reduce(((t,e)=>{let[s,i]=e;return t[s]=function(t){if("true"===t)return!0;if("false"===t)return!1;if("null"===t)return null;if(t===""+ +t)return+t;if(/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/.test(t))return JSON.parse(t);return t}(i),t}),{});function n(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];if(!i.length)return t;const l=i.shift();if(s(t)&&s(l))for(const[e,i]of Object.entries(l))t[e]=s(i)?n(t[e]||{},i):i;return n(t,...i)}function o(t,e){const s={};for(const[i,n]of Object.entries(e)){const e=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),i);s[i]={get:()=>e.get.call(t),set(s){e.set.call(t,s),"function"==typeof n&&n(s)},configurable:!0,enumerable:!0}}Object.defineProperties(t,s)}function l(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=s?e=>{let[s,i]=e;return t.dataset[s]=i}:e=>{let[s,i]=e;return t.setAttribute(s,i)};Object.entries(e).forEach(i)}class r{constructor(t,e){this.select=t,this.options=[...this.select.options],this.config=e,this.clearable=this.options.some((t=>!t.value&&!t.disabled)),this.direction=getComputedStyle(this.select).getPropertyValue("direction"),this.events={change:this.onChange.bind(this),keydown:this.onKeyDown.bind(this),pointerdown:this.onPointerDown.bind(this),pointerleave:this.onPointerLeave.bind(this),pointermove:this.onPointerMove.bind(this),reset:this.onReset.bind(this)},this.resetEvent=!1,o(this.select,{disabled:t=>this.state.disabled=t,value:t=>this.state.value=t}),this.init()}init(){this.render();const{disabled:t,index:e}=this.createState();!t&&this.handleEvents("add"),this.applySelection(e),"function"==typeof this.config.onInit&&this.config.onInit(this.select)}destroy(){this.reset(!1),this.state=this.initialState=null,this.handleEvents("remove"),this._select.remove(),o(this.select,{disabled:null,value:null}),"function"==typeof this.config.onDestroy&&this.config.onDestroy(this.select)}reset(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];["disabled","value"].forEach((t=>{const e=this.initialState[t];this.select[t]!==e&&(this.select[t]=e)})),t&&"function"==typeof this.config.onReset&&this.config.onReset(this.select)}applySelection(t,e){const s=e||-1!==t,{activeClass:i,selectedClass:n}=this.config.classList,o=t+1;if(this._select.dataset.rating=o,this._select.style.setProperty("--i",o),this.config.tooltip){var l;const e=(null===(l=this._options[t])||void 0===l?void 0:l.dataset.text)||this.select.querySelector('[value=""]').text;this._select.dataset.tooltip=e}this._options.forEach(((e,o)=>{e.classList.toggle(i,s&&o<=t),e.classList.toggle(n,s&&o===t),e.setAttribute("aria-selected",s&&o===t)})),this.indexActive=t}getIndex(t){return this._options.findIndex((e=>e.dataset.value===t))}createState(){const{disabled:t,value:e}=this.select;return this.initialState={disabled:t,index:this.getIndex(e),value:e},this.state=new Proxy({...this.initialState},{get:(t,e)=>t[e],set:(t,e,s)=>{if(t[e]===s)return!0;var i;(t[e]=s,"disabled"===e&&this.handleEvents(s?"remove":"add",this.resetEvent),"index"===e)&&(t.value=(null===(i=this._options[s])||void 0===i?void 0:i.dataset.value)||"");return"value"===e&&(t.index=this.getIndex(s)),this.applySelection(t.index),!0}})}createContainer(){const t=document.createElement("ul"),{containerClass:e}=this.config.classList,{label:s,orientation:i}=this.config,n=this.createItems();return e&&t.classList.add(...e.trim().split(" ")),l(t,{"aria-label":this.select.getAttribute("aria-label")||s,"aria-orientation":i,role:"listbox"},!1),t.style.setProperty("--n",n.length),t.append(...n),{container:t,items:n}}createItems(){const t=document.createElement("li"),{itemClass:e}=this.config.classList,{icon:s}=this.config;return e&&t.classList.add(...e.trim().split(" ")),l(t,{"aria-selected":!1,role:"option"},!1),s&&(t.innerHTML=s),this.options.filter((t=>t.value)).map(((e,s)=>{const i=t.cloneNode(!0);return l(i,{...e.dataset,index:s,value:e.value,text:e.text}),"function"==typeof this.config.items&&this.config.items(i,s),i}))}render(){const{container:t,items:e}=this.createContainer();this.select.insertAdjacentElement("afterend",t),this._select=t,this._options=e}eventListener(t,e,s){s.forEach((s=>t[e+"EventListener"](s,this.events[s])))}handleEvents(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{form:s}=this.select;s&&!e&&(this.eventListener(s,t,["reset"]),this.resetEvent="remove"!==t),this.eventListener(this.select,t,["change","keydown"]),this.eventListener(this._select,t,["pointerdown","pointerleave","pointermove"])}onChange(t){t.isTrusted&&(this.state.value=t.target.value),"function"==typeof this.config.onSelect&&this.config.onSelect(this.select)}onKeyDown(t){}onPointerDown(t){if("mouse"===t.pointerType&&0!==t.button)return;const e=t.target.closest('[role="option"]');if(!e)return;const{index:s,value:i}=e.dataset,n=+s===this.state.index;!this.clearable&&n||(this.select.value=this.clearable&&n?"":i,this.select.dispatchEvent(new Event("change")))}onPointerLeave(t){const{index:e}=this.state;e!==this.indexActive&&this.applySelection(e,!0)}onPointerMove(t){const e=t.target.closest('[role="option"]');if(!e)return;const s=+e.dataset.index;s!==this.indexActive&&this.applySelection(s,!0)}onReset(t){this.reset()}}return class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.selector=t,this.config=e,this.instances=[],this.build()}queryElements(t){switch(e(t)){case"HTMLSelectElement":return[t];case"NodeList":return[...t];case"String":return[...document.querySelectorAll(t)];default:return[]}}build(){this.queryElements(this.selector).forEach((e=>{if("SELECT"===e.tagName){const s=n({},t,this.config,i(e));this.instances.push(new r(e,s))}}))}destroy(){this.instances.forEach((t=>t.destroy())),this.instances=[]}rebuild(){this.destroy(),this.build()}reset(){this.instances.forEach((t=>t.reset()))}}}();
